# Variance-Guided Risk (ARX–GARCHX)

Minimal, reproducible code for a variance-guided mean–variance model with autoregressive dynamics. The repo includes:
- a **fast demo** (single scenario, single fit), and
- a **replication script** that regenerates the RMSE/Bias figures used in the manuscript.

---

## Repository structure

```
.
├─ R/
│  ├─ simulator_scenarios.r      # scenario generators (1–4)
│  └─ temporalVarGuid1.r         # core model: lmvt(), predict.lmvt()
├─ scripts/
│  ├─ 00_setup_env.R             # seeds + single-thread settings + session info
│  ├─ demo_algorithm.R           # one scenario, one fit (fast demo)
│  └─ run_main_results.R         # replication of paper-style figures
├─ outputs/
│  └─ .gitkeep                   # figures/CSVs written here
├─ LICENSE
├─ .gitignore
└─ README.md
```

---

## Quick start

1) **Install R packages:**
```r
install.packages(c("ggplot2","dplyr","tidyr"))
```

2) **Run the fast demo:**
```bash
Rscript scripts/demo_algorithm.R
```
This simulates **one** scenario using `simulate_scenario_smallT()`, fits the **variance-guided** model once (`use_x_in_variance = TRUE`), predicts \hat{\mu}, \hat{\sigma}, computes exceedance risk at the pooled 90th percentile cutoff, and writes two PNGs to `outputs/`.

3) **Reproduce the main simulation figures:**
```bash
Rscript scripts/run_main_results.R
```
This regenerates RMSE/Bias boxplots for `T ∈ {120, 240}` across scenarios and models A–D, and saves raw/summary CSVs.

---

## Script arguments

**Demo** *(scenario, S, T, seed)*:
```bash
Rscript scripts/demo_algorithm.R 3 5 240 99
# scenario=3, S=5 subjects, T=240 time points, seed=99
```

---

## Outputs

- **Demo** (subject-level view):
  - `outputs/scen<id>_subj1_y_mu_band.png`
  - `outputs/scen<id>_subj1_risk_vs_hits.png`
- **Main results** (boxplots):
  - `outputs/ABCD_s15_T120_ar1_RMSE.png`
  - `outputs/ABCD_s15_T120_ar1_Bias.png`
  - `outputs/ABCD_s15_T240_ar1_RMSE.png`
  - `outputs/ABCD_s15_T240_ar1_Bias.png`
- **CSV artifacts**:
  - `outputs/rep_raw_s15t120_by_rep_30reps.csv`
  - `outputs/rep_raw_s15t240_by_rep_30reps.csv`
  - `outputs/rep_summary_s15t120_30reps.csv`
  - `outputs/rep_summary_s15t240_30reps.csv`

---

## Requirements & reproducibility

- **R ≥ 4.2**
- Packages: **ggplot2**, **dplyr**, **tidyr**
- `scripts/00_setup_env.R`:
  - sets a global RNG seed,
  - caps BLAS/LAPACK to single thread for determinism,
  - writes a one-time `session_info.txt` in the repo root.

### (Optional) Lock dependencies with `renv`
```r
install.packages("renv")
renv::init(); renv::snapshot()   # creates renv.lock for reproducible restores
```

---

## Using the model on your data

Your data frame should include `s` (subject id), `t` (time), `y` (outcome), and covariates.
```r
source("R/temporalVarGuid1.r")
fit <- lmvt(df, p=1, q=0, r=1, s_ord=1,
            lambda_beta=0.01, lambda_gamma=0.01,
            standardize_X=TRUE, use_x_in_variance=TRUE)
pred <- predict.lmvt(fit, newdata=df, innov_g=TRUE)

c_cut <- quantile(df$y, 0.90, na.rm = TRUE)     # pooled cutoff example
z <- (c_cut - pred$muhat) / pmax(pred$sigmahat, 1e-8)
p_exceed <- 1 - pnorm(z)
```

---

## Code & data availability

**Code.** All code to implement the method and reproduce figures is included here. Minimal example: `scripts/demo_algorithm.R`; full replication: `scripts/run_main_results.R`.

**Data.** All analyses use **simulated** data generated by `R/simulator_scenarios.r`. No external datasets are required.

---

## License

Released under the MIT License (see `LICENSE`).

---

## Citation

If you use this repository, please cite the accompanying manuscript. A DOI (Zenodo/OSF) and `CITATION.cff` will be added upon release.
